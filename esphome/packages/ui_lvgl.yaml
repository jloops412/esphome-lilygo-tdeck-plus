
script:
  - id: note_activity
    then:
      - lambda: |-
          id(last_activity_ms) = esphome::millis();
      - if:
          condition:
            lambda: "return id(screensaver_active);"
          then:
            - script.execute: wake_display

  - id: page_next
    then:
      - lvgl.page.next:
      - script.execute: lvgl_update_dynamic

  - id: page_prev
    then:
      - lvgl.page.previous:
      - script.execute: lvgl_update_dynamic

  - id: wake_display
    then:
      - lambda: |-
          id(screensaver_active) = false;
      - light.turn_on:
          id: tft_backlight
          brightness: !lambda "return id(backlight_percent) / 100.0f;"
      - script.execute: kb_backlight_apply
      - lvgl.resume:
      - script.execute: lvgl_update_dynamic

  - id: sleep_display
    then:
      - lambda: |-
          id(screensaver_active) = true;
      - lvgl.pause:
          show_snow: false
      - light.turn_off: tft_backlight

  - id: kb_backlight_apply
    then:
      - lambda: |-
          int pct = id(kb_backlight_percent);
          if (pct < 0) pct = 0;
          if (pct > 100) pct = 100;

          int live = (pct * 255) / 100;
          int defv = live;
          if (pct > 0 && defv < 30) defv = 30;

          uint8_t cmd_default[2] = {0x02, (uint8_t)(pct > 0 ? defv : 30)};
          uint8_t cmd_live[2] = {0x01, (uint8_t)live};

          id(bus_a).write(0x55, cmd_default, 2);
          delay(5);
          id(bus_a).write(0x55, cmd_live, 2);

  - id: kb_backlight_toggle
    then:
      - lambda: |-
          if (id(kb_backlight_percent) > 0) {
            id(kb_backlight_last_nonzero) = id(kb_backlight_percent);
            id(kb_backlight_percent) = 0;
          } else {
            if (id(kb_backlight_last_nonzero) <= 0) id(kb_backlight_last_nonzero) = 70;
            id(kb_backlight_percent) = id(kb_backlight_last_nonzero);
          }
      - script.execute: kb_backlight_apply
      - script.execute: lvgl_update_dynamic

  - id: kb_backlight_down
    then:
      - lambda: |-
          id(kb_backlight_percent) -= 20;
          if (id(kb_backlight_percent) < 0) id(kb_backlight_percent) = 0;
          if (id(kb_backlight_percent) > 0) id(kb_backlight_last_nonzero) = id(kb_backlight_percent);
      - script.execute: kb_backlight_apply
      - script.execute: lvgl_update_dynamic

  - id: kb_backlight_up
    then:
      - lambda: |-
          id(kb_backlight_percent) += 20;
          if (id(kb_backlight_percent) > 100) id(kb_backlight_percent) = 100;
          if (id(kb_backlight_percent) > 0) id(kb_backlight_last_nonzero) = id(kb_backlight_percent);
      - script.execute: kb_backlight_apply
      - script.execute: lvgl_update_dynamic

  - id: saver_timeout_down
    then:
      - lambda: |-
          id(screensaver_timeout_s) -= 5;
          if (id(screensaver_timeout_s) < 10) id(screensaver_timeout_s) = 10;
      - script.execute: lvgl_update_dynamic

  - id: saver_timeout_up
    then:
      - lambda: |-
          id(screensaver_timeout_s) += 5;
          if (id(screensaver_timeout_s) > 300) id(screensaver_timeout_s) = 300;
      - script.execute: lvgl_update_dynamic

  - id: toggle_wake_touch
    then:
      - lambda: |-
          id(wake_on_touch) = !id(wake_on_touch);
      - script.execute: lvgl_update_dynamic

  - id: toggle_wake_keyboard
    then:
      - lambda: |-
          id(wake_on_keyboard) = !id(wake_on_keyboard);
      - script.execute: lvgl_update_dynamic

  - id: toggle_wake_trackball
    then:
      - lambda: |-
          id(wake_on_trackball) = !id(wake_on_trackball);
      - script.execute: lvgl_update_dynamic

  - id: toggle_touch_debug
    then:
      - lambda: |-
          id(touch_debug) = !id(touch_debug);
      - script.execute: lvgl_update_dynamic

  - id: start_touch_calibration
    then:
      - lambda: |-
          id(touch_cal_mode) = true;
          id(touch_cal_step) = 0;
          id(touch_active) = false;
          id(cal_raw_tl_x) = 0; id(cal_raw_tl_y) = 0;
          id(cal_raw_tr_x) = 0; id(cal_raw_tr_y) = 0;
          id(cal_raw_bl_x) = 0; id(cal_raw_bl_y) = 0;
          id(cal_raw_br_x) = 0; id(cal_raw_br_y) = 0;
          id(cal9_raw_tl_x) = 0; id(cal9_raw_tl_y) = 0;
          id(cal9_raw_tc_x) = 0; id(cal9_raw_tc_y) = 0;
          id(cal9_raw_tr_x) = 0; id(cal9_raw_tr_y) = 0;
          id(cal9_raw_ml_x) = 0; id(cal9_raw_ml_y) = 0;
          id(cal9_raw_mc_x) = 0; id(cal9_raw_mc_y) = 0;
          id(cal9_raw_mr_x) = 0; id(cal9_raw_mr_y) = 0;
          id(cal9_raw_bl_x) = 0; id(cal9_raw_bl_y) = 0;
          id(cal9_raw_bc_x) = 0; id(cal9_raw_bc_y) = 0;
          id(cal9_raw_br_x) = 0; id(cal9_raw_br_y) = 0;
      - lvgl.page.show: touch_cal_page
      - script.execute: lvgl_update_dynamic

  - id: reset_touch_calibration
    then:
      - lambda: |-
          id(cal_dx_tl) = 0; id(cal_dy_tl) = 0;
          id(cal_dx_tc) = 0; id(cal_dy_tc) = 0;
          id(cal_dx_tr) = 0; id(cal_dy_tr) = 0;
          id(cal_dx_ml) = 0; id(cal_dy_ml) = 0;
          id(cal_dx_mc) = 0; id(cal_dy_mc) = 0;
          id(cal_dx_mr) = 0; id(cal_dy_mr) = 0;
          id(cal_dx_bl) = 0; id(cal_dy_bl) = 0;
          id(cal_dx_bc) = 0; id(cal_dy_bc) = 0;
          id(cal_dx_br) = 0; id(cal_dy_br) = 0;
          id(cal_raw_tl_x) = 0; id(cal_raw_tl_y) = 0;
          id(cal_raw_tr_x) = 0; id(cal_raw_tr_y) = 0;
          id(cal_raw_bl_x) = 0; id(cal_raw_bl_y) = 0;
          id(cal_raw_br_x) = 0; id(cal_raw_br_y) = 0;
          id(cal9_raw_tl_x) = 0; id(cal9_raw_tl_y) = 0;
          id(cal9_raw_tc_x) = 0; id(cal9_raw_tc_y) = 0;
          id(cal9_raw_tr_x) = 0; id(cal9_raw_tr_y) = 0;
          id(cal9_raw_ml_x) = 0; id(cal9_raw_ml_y) = 0;
          id(cal9_raw_mc_x) = 0; id(cal9_raw_mc_y) = 0;
          id(cal9_raw_mr_x) = 0; id(cal9_raw_mr_y) = 0;
          id(cal9_raw_bl_x) = 0; id(cal9_raw_bl_y) = 0;
          id(cal9_raw_bc_x) = 0; id(cal9_raw_bc_y) = 0;
          id(cal9_raw_br_x) = 0; id(cal9_raw_br_y) = 0;
          id(touch_cal_mode) = false;
          id(touch_cal_step) = 0;
      - lambda: |-
          id(touch_cal_suggest_x_min) = atoi("${touch_x_min}");
          id(touch_cal_suggest_x_max) = atoi("${touch_x_max}");
          id(touch_cal_suggest_y_min) = atoi("${touch_y_min}");
          id(touch_cal_suggest_y_max) = atoi("${touch_y_max}");
      - script.execute: touch_cal_apply_stored
      - script.execute: lvgl_update_dynamic

  - id: touch_cal_apply_stored
    then:
      - lambda: |-
          if (id(touch_cal_suggest_x_max) > id(touch_cal_suggest_x_min) &&
              id(touch_cal_suggest_y_max) > id(touch_cal_suggest_y_min)) {
            id(tdeck_touch).set_calibration(
              id(touch_cal_suggest_x_min),
              id(touch_cal_suggest_x_max),
              id(touch_cal_suggest_y_min),
              id(touch_cal_suggest_y_max)
            );
            ESP_LOGI("touch_cal", "Using persisted calibration x_min=%d x_max=%d y_min=%d y_max=%d",
                     id(touch_cal_suggest_x_min),
                     id(touch_cal_suggest_x_max),
                     id(touch_cal_suggest_y_min),
                     id(touch_cal_suggest_y_max));
          }

  - id: select_light
    parameters:
      idx: int
    then:
      - lambda: |-
          if (idx < 0) idx = 0;
          if (idx > 5) idx = 5;
          id(selected_light) = idx;
      - script.execute: lvgl_update_dynamic

  - id: display_backlight_down
    then:
      - lambda: |-
          id(backlight_percent) -= 10;
          if (id(backlight_percent) < 10) id(backlight_percent) = 10;
      - light.turn_on:
          id: tft_backlight
          brightness: !lambda "return id(backlight_percent) / 100.0f;"
      - script.execute: lvgl_update_dynamic

  - id: display_backlight_up
    then:
      - lambda: |-
          id(backlight_percent) += 10;
          if (id(backlight_percent) > 100) id(backlight_percent) = 100;
      - light.turn_on:
          id: tft_backlight
          brightness: !lambda "return id(backlight_percent) / 100.0f;"
      - script.execute: lvgl_update_dynamic

  - id: selected_light_prev
    then:
      - lambda: |-
          id(selected_light) = (id(selected_light) + 5) % 6;
      - script.execute: lvgl_update_dynamic

  - id: selected_light_next
    then:
      - lambda: |-
          id(selected_light) = (id(selected_light) + 1) % 6;
      - script.execute: lvgl_update_dynamic

  - id: selected_light_toggle
    then:
      - homeassistant.action:
          action: light.toggle
          data:
            entity_id: !lambda |-
              switch (id(selected_light)) {
                case 0: return std::string("light.foyer_lights");
                case 1: return std::string("light.main_vanity_lights");
                case 2: return std::string("light.bedroom_lamp");
                case 3: return std::string("light.hall_lights");
                case 4: return std::string("light.office_lamps");
                default: return std::string("light.upstairs_lights");
              }

  - id: selected_light_brighter
    then:
      - homeassistant.action:
          action: light.turn_on
          data:
            entity_id: !lambda |-
              switch (id(selected_light)) {
                case 0: return std::string("light.foyer_lights");
                case 1: return std::string("light.main_vanity_lights");
                case 2: return std::string("light.bedroom_lamp");
                case 3: return std::string("light.hall_lights");
                case 4: return std::string("light.office_lamps");
                default: return std::string("light.upstairs_lights");
              }
            brightness_step_pct: "20"

  - id: selected_light_dimmer
    then:
      - homeassistant.action:
          action: light.turn_on
          data:
            entity_id: !lambda |-
              switch (id(selected_light)) {
                case 0: return std::string("light.foyer_lights");
                case 1: return std::string("light.main_vanity_lights");
                case 2: return std::string("light.bedroom_lamp");
                case 3: return std::string("light.hall_lights");
                case 4: return std::string("light.office_lamps");
                default: return std::string("light.upstairs_lights");
              }
            brightness_step_pct: "-20"

  - id: selected_light_warm
    then:
      - homeassistant.action:
          action: light.turn_on
          data:
            entity_id: !lambda |-
              switch (id(selected_light)) {
                case 0: return std::string("light.foyer_lights");
                case 1: return std::string("light.main_vanity_lights");
                case 2: return std::string("light.bedroom_lamp");
                case 3: return std::string("light.hall_lights");
                case 4: return std::string("light.office_lamps");
                default: return std::string("light.upstairs_lights");
              }
            color_temp_kelvin: "2700"
      - script.execute: lvgl_update_dynamic

  - id: selected_light_cool
    then:
      - homeassistant.action:
          action: light.turn_on
          data:
            entity_id: !lambda |-
              switch (id(selected_light)) {
                case 0: return std::string("light.foyer_lights");
                case 1: return std::string("light.main_vanity_lights");
                case 2: return std::string("light.bedroom_lamp");
                case 3: return std::string("light.hall_lights");
                case 4: return std::string("light.office_lamps");
                default: return std::string("light.upstairs_lights");
              }
            color_temp_kelvin: "6500"
      - script.execute: lvgl_update_dynamic

  - id: selected_light_color
    parameters:
      cname: string
    then:
      - homeassistant.action:
          action: light.turn_on
          data:
            entity_id: !lambda |-
              switch (id(selected_light)) {
                case 0: return std::string("light.foyer_lights");
                case 1: return std::string("light.main_vanity_lights");
                case 2: return std::string("light.bedroom_lamp");
                case 3: return std::string("light.hall_lights");
                case 4: return std::string("light.office_lamps");
                default: return std::string("light.upstairs_lights");
              }
            color_name: !lambda "return cname;"
      - script.execute: lvgl_update_dynamic

  - id: selected_light_preset_cycle
    then:
      - lambda: |-
          id(light_preset_index) = (id(light_preset_index) + 1) % 5;
      - if:
          condition:
            lambda: "return id(light_preset_index) == 0;"
          then:
            - script.execute: selected_light_warm
      - if:
          condition:
            lambda: "return id(light_preset_index) == 1;"
          then:
            - script.execute: selected_light_cool
      - if:
          condition:
            lambda: "return id(light_preset_index) == 2;"
          then:
            - script.execute:
                id: selected_light_color
                cname: "orange"
      - if:
          condition:
            lambda: "return id(light_preset_index) == 3;"
          then:
            - script.execute:
                id: selected_light_color
                cname: "white"
      - if:
          condition:
            lambda: "return id(light_preset_index) == 4;"
          then:
            - script.execute:
                id: selected_light_color
                cname: "purple"
      - script.execute: lvgl_update_dynamic

  - id: theme_prev
    then:
      - lambda: |-
          id(theme_index) = (id(theme_index) + 2) % 3;
      - script.execute: apply_theme

  - id: theme_next
    then:
      - lambda: |-
          id(theme_index) = (id(theme_index) + 1) % 3;
      - script.execute: apply_theme

  - id: apply_theme
    then:
      - if:
          condition:
            lambda: "return id(theme_index) == 0;"
          then:
            - lvgl.style.update:
                id: lv_style_screen
                bg_color: 0x05070A
                text_color: 0xF2F6FF
            - lvgl.style.update:
                id: lv_style_card
                bg_color: 0x0F1624
                border_color: 0x283A56
            - lvgl.style.update:
                id: lv_style_btn
                bg_color: 0x17253B
                border_color: 0x2F6FD8
                text_color: 0xF2F6FF
            - lvgl.style.update:
                id: lv_style_btn_soft
                bg_color: 0x131A28
                border_color: 0x36435D
                text_color: 0xDCE7FF
            - lvgl.style.update:
                id: lv_style_btn_warn
                bg_color: 0x3C1E1E
                border_color: 0xB84747
                text_color: 0xFFE7E7
            - lvgl.style.update:
                id: lv_style_btn_ok
                bg_color: 0x173022
                border_color: 0x39A466
                text_color: 0xE8FFF2
      - if:
          condition:
            lambda: "return id(theme_index) == 1;"
          then:
            - lvgl.style.update:
                id: lv_style_screen
                bg_color: 0x071018
                text_color: 0xEAF4FF
            - lvgl.style.update:
                id: lv_style_card
                bg_color: 0x0D1B2A
                border_color: 0x2F5D86
            - lvgl.style.update:
                id: lv_style_btn
                bg_color: 0x14304A
                border_color: 0x2C84C7
                text_color: 0xEAF4FF
            - lvgl.style.update:
                id: lv_style_btn_soft
                bg_color: 0x113045
                border_color: 0x2F5D86
                text_color: 0xEAF4FF
            - lvgl.style.update:
                id: lv_style_btn_warn
                bg_color: 0x3A231A
                border_color: 0xD0673B
                text_color: 0xFFEBDC
            - lvgl.style.update:
                id: lv_style_btn_ok
                bg_color: 0x103A34
                border_color: 0x1A9F9F
                text_color: 0xE8FFFF
      - if:
          condition:
            lambda: "return id(theme_index) == 2;"
          then:
            - lvgl.style.update:
                id: lv_style_screen
                bg_color: 0x120D08
                text_color: 0xFFF1E4
            - lvgl.style.update:
                id: lv_style_card
                bg_color: 0x24170F
                border_color: 0x855D36
            - lvgl.style.update:
                id: lv_style_btn
                bg_color: 0x3A2517
                border_color: 0xC4822F
                text_color: 0xFFF1E4
            - lvgl.style.update:
                id: lv_style_btn_soft
                bg_color: 0x332012
                border_color: 0x94653B
                text_color: 0xFFF1E4
            - lvgl.style.update:
                id: lv_style_btn_warn
                bg_color: 0x4D1818
                border_color: 0xD15757
                text_color: 0xFFE7E7
            - lvgl.style.update:
                id: lv_style_btn_ok
                bg_color: 0x304018
                border_color: 0x7FAE32
                text_color: 0xF4FFE2
      - script.execute: lvgl_update_dynamic

  - id: open_detail_bbc
    then:
      - lambda: |-
          id(detail_source) = 0;
      - script.execute: refresh_detail_page
      - lvgl.page.show: detail_page

  - id: open_detail_dc
    then:
      - lambda: |-
          id(detail_source) = 1;
      - script.execute: refresh_detail_page
      - lvgl.page.show: detail_page

  - id: open_detail_loudoun
    then:
      - lambda: |-
          id(detail_source) = 2;
      - script.execute: refresh_detail_page
      - lvgl.page.show: detail_page

  - id: open_detail_word
    then:
      - lambda: |-
          id(detail_source) = 3;
      - script.execute: refresh_detail_page
      - lvgl.page.show: detail_page

  - id: open_detail_quote
    then:
      - lambda: |-
          id(detail_source) = 4;
      - script.execute: refresh_detail_page
      - lvgl.page.show: detail_page

  - id: open_shortcuts
    then:
      - lvgl.page.show: shortcuts_page
      - script.execute: lvgl_update_dynamic

  - id: refresh_detail_page
    then:
      - lvgl.label.update:
          id: detail_title_lbl
          text: !lambda |-
            if (id(detail_source) == 0) return std::string("BBC");
            if (id(detail_source) == 1) return std::string("DC");
            if (id(detail_source) == 2) return std::string("Loudoun");
            if (id(detail_source) == 3) return std::string("Word of the Day");
            return std::string("Quote of the Hour");
      - lvgl.label.update:
          id: detail_body_lbl
          text: !lambda |-
            if (id(detail_source) == 0) {
              if (id(feed_bbc_title).has_state() && !id(feed_bbc_title).state.empty()) return id(feed_bbc_title).state;
              if (id(feed_bbc_message).has_state() && !id(feed_bbc_message).state.empty()) return id(feed_bbc_message).state;
              if (id(feed_bbc_state).has_state()) return id(feed_bbc_state).state;
            }
            if (id(detail_source) == 1) {
              if (id(feed_dc_title).has_state() && !id(feed_dc_title).state.empty()) return id(feed_dc_title).state;
              if (id(feed_dc_message).has_state() && !id(feed_dc_message).state.empty()) return id(feed_dc_message).state;
              if (id(feed_dc_state).has_state()) return id(feed_dc_state).state;
            }
            if (id(detail_source) == 2) {
              if (id(feed_loudoun_title).has_state() && !id(feed_loudoun_title).state.empty()) return id(feed_loudoun_title).state;
              if (id(feed_loudoun_message).has_state() && !id(feed_loudoun_message).state.empty()) return id(feed_loudoun_message).state;
              if (id(feed_loudoun_state).has_state()) return id(feed_loudoun_state).state;
            }
            if (id(detail_source) == 3 && id(word_of_day).has_state()) return id(word_of_day).state;
            if (id(detail_source) == 4 && id(quote_of_hour).has_state()) return id(quote_of_hour).state;
            return std::string("No readable content available.");

  - id: lvgl_update_dynamic
    then:
      - lvgl.label.update:
          id: home_status_lbl
          text: !lambda |-
            char buf[128];
            float sats = id(gps_satellites).state;
            if (sats > 0.0f) {
              snprintf(buf, sizeof(buf), "Batt %.0f%%  WiFi %.0fdBm  GPS %.0f sat  |  Alt+K keys", id(battery_percent).state, id(wifi_signal_tdeck).state, sats);
            } else {
              snprintf(buf, sizeof(buf), "Batt %.0f%%  WiFi %.0fdBm  GPS searching  |  Alt+K keys", id(battery_percent).state, id(wifi_signal_tdeck).state);
            }
            return std::string(buf);
      - lvgl.label.update:
          id: lights_selected_lbl
          text: !lambda |-
            auto name = std::string("Upstairs");
            if (id(selected_light) == 0) name = "Foyer";
            else if (id(selected_light) == 1) name = "Vanity";
            else if (id(selected_light) == 2) name = "Bedroom";
            else if (id(selected_light) == 3) name = "Hall";
            else if (id(selected_light) == 4) name = "Office";

            auto state = std::string("-");
            if (id(selected_light) == 0 && id(foyer_state).has_state()) state = id(foyer_state).state;
            else if (id(selected_light) == 1 && id(vanity_state).has_state()) state = id(vanity_state).state;
            else if (id(selected_light) == 2 && id(bedroom_state).has_state()) state = id(bedroom_state).state;
            else if (id(selected_light) == 3 && id(hall_state).has_state()) state = id(hall_state).state;
            else if (id(selected_light) == 4 && id(office_state).has_state()) state = id(office_state).state;
            else if (id(selected_light) == 5 && id(upstairs_state).has_state()) state = id(upstairs_state).state;

            return std::string("Active\n") + name + "\n" + state;
      - lvgl.label.update:
          id: light_foyer_lbl
          text: !lambda |-
            std::string s = id(foyer_state).has_state() ? id(foyer_state).state : "-";
            std::string p = (id(selected_light) == 0) ? "> " : "  ";
            return p + std::string("Foyer ") + s;
      - lvgl.label.update:
          id: light_vanity_lbl
          text: !lambda |-
            std::string s = id(vanity_state).has_state() ? id(vanity_state).state : "-";
            std::string p = (id(selected_light) == 1) ? "> " : "  ";
            return p + std::string("Vanity ") + s;
      - lvgl.label.update:
          id: light_bedroom_lbl
          text: !lambda |-
            std::string s = id(bedroom_state).has_state() ? id(bedroom_state).state : "-";
            std::string p = (id(selected_light) == 2) ? "> " : "  ";
            return p + std::string("Bed ") + s;
      - lvgl.label.update:
          id: light_hall_lbl
          text: !lambda |-
            std::string s = id(hall_state).has_state() ? id(hall_state).state : "-";
            std::string p = (id(selected_light) == 3) ? "> " : "  ";
            return p + std::string("Hall ") + s;
      - lvgl.label.update:
          id: light_office_lbl
          text: !lambda |-
            std::string s = id(office_state).has_state() ? id(office_state).state : "-";
            std::string p = (id(selected_light) == 4) ? "> " : "  ";
            return p + std::string("Office ") + s;
      - lvgl.label.update:
          id: light_upstairs_lbl
          text: !lambda |-
            std::string s = id(upstairs_state).has_state() ? id(upstairs_state).state : "-";
            std::string p = (id(selected_light) == 5) ? "> " : "  ";
            return p + std::string("Upstairs ") + s;
      - lvgl.label.update:
          id: lights_preset_lbl
          text: !lambda |-
            if (id(light_preset_index) == 0) return std::string("Preset: Warm");
            if (id(light_preset_index) == 1) return std::string("Preset: Cool");
            if (id(light_preset_index) == 2) return std::string("Preset: Relax");
            if (id(light_preset_index) == 3) return std::string("Preset: Focus");
            return std::string("Preset: Party");
      - lvgl.label.update:
          id: weather_temp_lbl
          text: !lambda |-
            if (id(wx_temp).state != id(wx_temp).state) return std::string("--");
            char buf[16];
            snprintf(buf, sizeof(buf), "%.1f", id(wx_temp).state);
            return std::string(buf);
      - lvgl.label.update:
          id: weather_cond_lbl
          text: !lambda |-
            if (id(wx_weather).has_state() && !id(wx_weather).state.empty()) return id(wx_weather).state;
            if (id(wx_condition).has_state() && !id(wx_condition).state.empty()) return id(wx_condition).state;
            return std::string("-");
      - lvgl.label.update:
          id: weather_feels_lbl
          text: !lambda |-
            if (id(wx_feels).state != id(wx_feels).state) return std::string("Feels --");
            char buf[24];
            snprintf(buf, sizeof(buf), "Feels %.1f", id(wx_feels).state);
            return std::string(buf);
      - lvgl.label.update:
          id: weather_metrics_lbl
          text: !lambda |-
            char buf[160];
            auto hum = (id(wx_humidity).state == id(wx_humidity).state) ? id(wx_humidity).state : 0;
            auto wind = (id(wx_wind_speed).state == id(wx_wind_speed).state) ? id(wx_wind_speed).state : 0;
            auto uv = (id(wx_uv).state == id(wx_uv).state) ? id(wx_uv).state : 0;
            auto clouds = (id(wx_clouds).state == id(wx_clouds).state) ? id(wx_clouds).state : 0;
            auto press = (id(wx_pressure).state == id(wx_pressure).state) ? id(wx_pressure).state : 0;
            snprintf(buf, sizeof(buf), "Hum %.0f%%  Wind %.0f  UV %.1f\nCloud %.0f%%  Press %.0f", hum, wind, uv, clouds, press);
            return std::string(buf);
      - lvgl.label.update:
          id: settings_status_lbl
          text: !lambda |-
            char buf[160];
            snprintf(buf, sizeof(buf), "Saver %ds | Wake T/K/B %s/%s/%s | KB %d%%",
                     id(screensaver_timeout_s),
                     id(wake_on_touch) ? "ON" : "OFF",
                     id(wake_on_keyboard) ? "ON" : "OFF",
                     id(wake_on_trackball) ? "ON" : "OFF",
                     id(kb_backlight_percent));
            return std::string(buf);
      - lvgl.label.update:
          id: theme_status_lbl
          text: !lambda |-
            const char *name = "Graphite";
            if (id(theme_index) == 1) name = "Ocean";
            if (id(theme_index) == 2) name = "Amber";
            char buf[96];
            snprintf(buf, sizeof(buf), "Theme %s | Display %d%% | Debug %s",
                     name,
                     id(backlight_percent),
                     id(touch_debug) ? "ON" : "OFF");
            return std::string(buf);
      - lvgl.label.update:
          id: shortcuts_body_lbl
          text: !lambda |-
            return std::string(
              "Alt+K or / : this shortcuts page\n"
              "1..6 : Home/Lights/Weather/Reader/Settings/Theme\n"
              "Q/E : previous/next page\n"
              "Tab or D/S : focus next\n"
              "Esc or A/W : focus previous\n"
              "[ ] : select light  -/+ : dim/bright\n"
              "T : toggle light    P : preset cycle\n"
              "B/N/M : keyboard light toggle/down/up\n"
              "K : start calibration   R : reset calibration\n"
              "C : toggle touch debug"
            );
      - lvgl.label.update:
          id: touch_cal_step_lbl
          text: !lambda |-
            if (id(touch_cal_mode)) {
              if (id(touch_cal_step) == 0) return std::string("1/9 TOP LEFT");
              if (id(touch_cal_step) == 1) return std::string("2/9 TOP CENTER");
              if (id(touch_cal_step) == 2) return std::string("3/9 TOP RIGHT");
              if (id(touch_cal_step) == 3) return std::string("4/9 MID LEFT");
              if (id(touch_cal_step) == 4) return std::string("5/9 CENTER");
              if (id(touch_cal_step) == 5) return std::string("6/9 MID RIGHT");
              if (id(touch_cal_step) == 6) return std::string("7/9 BOTTOM LEFT");
              if (id(touch_cal_step) == 7) return std::string("8/9 BOTTOM CENTER");
              return std::string("9/9 BOTTOM RIGHT");
            }
            if (id(touch_cal_suggest_x_max) > id(touch_cal_suggest_x_min) &&
                id(touch_cal_suggest_y_max) > id(touch_cal_suggest_y_min)) {
              return std::string("Calibration applied and saved.");
            }
            return std::string("Press Start TouchCal to begin.");
      - lvgl.label.update:
          id: touch_cal_result_lbl
          text: !lambda |-
            char buf[180];
            if (id(touch_cal_suggest_x_max) > id(touch_cal_suggest_x_min) &&
                id(touch_cal_suggest_y_max) > id(touch_cal_suggest_y_min)) {
              snprintf(buf, sizeof(buf),
                       "x:%d-%d y:%d-%d raw:%d,%d",
                       id(touch_cal_suggest_x_min), id(touch_cal_suggest_x_max),
                       id(touch_cal_suggest_y_min), id(touch_cal_suggest_y_max),
                       id(touch_raw_x_last), id(touch_raw_y_last));
              return std::string(buf);
            }
            snprintf(buf, sizeof(buf),
                     "raw:%d,%d  tap highlighted marker",
                     id(touch_raw_x_last), id(touch_raw_y_last));
            return std::string(buf);
      - lvgl.label.update:
          id: touch_cal_p0_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 0) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p1_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 1) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p2_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 2) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p3_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 3) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p4_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 4) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p5_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 5) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p6_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 6) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p7_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 7) ? std::string(\"X\") : std::string(\"+\");"
      - lvgl.label.update:
          id: touch_cal_p8_lbl
          text: !lambda "return (id(touch_cal_mode) && id(touch_cal_step) == 8) ? std::string(\"X\") : std::string(\"+\");"

interval:
  - interval: 1s
    then:
      - lambda: |-
          uint32_t now = esphome::millis();
          uint32_t idle_ms = now - id(last_activity_ms);
          if (id(screensaver_enabled) && !id(screensaver_active)) {
            if (idle_ms >= (uint32_t) id(screensaver_timeout_s) * 1000UL) {
              id(sleep_display).execute();
            }
          }

  - interval: 2s
    then:
      - if:
          condition:
            lambda: "return !id(screensaver_active);"
          then:
            - script.execute: lvgl_update_dynamic

  - interval: 15s
    then:
      - if:
          condition:
            lambda: "return id(kb_backlight_percent) > 0;"
          then:
            - script.execute: kb_backlight_apply

lvgl:
  displays:
    - tft
  touchscreens:
    - tdeck_touch
  keypads:
    - id: nav_keypad
      group: nav_group
      prev: tb_left
      next: tb_right
      up: tb_up
      down: tb_down
      enter: tb_click

  on_boot:
    then:
      - lambda: |-
          if (id(touch_cal_suggest_x_max) <= id(touch_cal_suggest_x_min) ||
              id(touch_cal_suggest_y_max) <= id(touch_cal_suggest_y_min)) {
            id(touch_cal_suggest_x_min) = atoi("${touch_x_min}");
            id(touch_cal_suggest_x_max) = atoi("${touch_x_max}");
            id(touch_cal_suggest_y_min) = atoi("${touch_y_min}");
            id(touch_cal_suggest_y_max) = atoi("${touch_y_max}");
          }
      - script.execute: touch_cal_apply_stored
      - script.execute: apply_theme
      - lvgl.widget.focus: home_lights_btn
      - script.execute: lvgl_update_dynamic

  style_definitions:
    - id: lv_style_screen
      bg_opa: cover
      bg_color: 0x05070A
      text_color: 0xF2F6FF
    - id: lv_style_card
      bg_opa: cover
      bg_color: 0x0F1624
      border_width: 2
      border_color: 0x283A56
      radius: 10
      pad_all: 6
      text_color: 0xF2F6FF
    - id: lv_style_btn
      bg_opa: cover
      bg_color: 0x17253B
      border_width: 2
      border_color: 0x2F6FD8
      radius: 10
      text_color: 0xF2F6FF
      pad_all: 4
    - id: lv_style_btn_soft
      bg_opa: cover
      bg_color: 0x131A28
      border_width: 2
      border_color: 0x36435D
      radius: 10
      text_color: 0xDCE7FF
      pad_all: 4
    - id: lv_style_btn_warn
      bg_opa: cover
      bg_color: 0x3C1E1E
      border_width: 2
      border_color: 0xB84747
      radius: 10
      text_color: 0xFFE7E7
      pad_all: 4
    - id: lv_style_btn_ok
      bg_opa: cover
      bg_color: 0x173022
      border_width: 2
      border_color: 0x39A466
      radius: 10
      text_color: 0xE8FFF2
      pad_all: 4

  pages:
    - id: home_page
      styles: [lv_style_screen]
      widgets:
        - label:
            x: 12
            y: 8
            text: "T-Deck Controller"
        - button:
            id: home_keys_btn
            x: 258
            y: 6
            width: 54
            height: 26
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute: open_shortcuts
            widgets:
              - label:
                  text: "Keys"
                  align: CENTER
        - label:
            id: home_status_lbl
            x: 12
            y: 40
            width: 296
            text: "Status"
        - button:
            id: home_lights_btn
            x: 12
            y: 72
            width: 146
            height: 56
            styles: [lv_style_btn_ok]
            group: nav_group
            on_click:
              - lvgl.page.show: lights_page
            widgets:
              - label:
                  text: "Lights Control"
                  align: CENTER
        - button:
            id: home_weather_btn
            x: 162
            y: 72
            width: 146
            height: 56
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lvgl.page.show: weather_page
            widgets:
              - label:
                  text: "Weather Board"
                  align: CENTER
        - button:
            id: home_reader_btn
            x: 12
            y: 136
            width: 96
            height: 56
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - lvgl.page.show: reader_page
            widgets:
              - label:
                  text: "Reader"
                  align: CENTER
        - button:
            id: home_settings_btn
            x: 112
            y: 136
            width: 96
            height: 56
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - lvgl.page.show: settings_page
            widgets:
              - label:
                  text: "Settings"
                  align: CENTER
        - button:
            id: home_theme_btn
            x: 212
            y: 136
            width: 96
            height: 56
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - lvgl.page.show: theme_page
            widgets:
              - label:
                  text: "Themes"
                  align: CENTER
        - button:
            id: home_sleep_btn
            x: 12
            y: 198
            width: 96
            height: 34
            styles: [lv_style_btn_warn]
            group: nav_group
            on_click:
              - script.execute: sleep_display
            widgets:
              - label:
                  text: "Sleep"
                  align: CENTER
        - button:
            id: home_shortcuts_btn
            x: 112
            y: 198
            width: 96
            height: 34
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute: open_shortcuts
            widgets:
              - label:
                  text: "Shortcuts"
                  align: CENTER
        - button:
            id: home_cal_btn
            x: 212
            y: 198
            width: 96
            height: 34
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute: start_touch_calibration
            widgets:
              - label:
                  text: "TouchCal"
                  align: CENTER

    - id: lights_page
      styles: [lv_style_screen]
      widgets:
        - button:
            id: lights_home_btn
            x: 8
            y: 6
            width: 60
            height: 30
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lvgl.page.show: home_page
            widgets:
              - label:
                  text: "Home"
                  align: CENTER
        - label:
            x: 132
            y: 10
            text: "Lights"
        - label:
            id: lights_selected_lbl
            x: 196
            y: 12
            width: 116
            text: "Selected"
        - button:
            id: light_foyer_btn
            x: 12
            y: 40
            width: 86
            height: 40
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute:
                  id: select_light
                  idx: 0
            widgets:
              - label:
                  id: light_foyer_lbl
                  text: "Foyer"
                  align: CENTER
        - button:
            id: light_vanity_btn
            x: 104
            y: 40
            width: 86
            height: 40
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute:
                  id: select_light
                  idx: 1
            widgets:
              - label:
                  id: light_vanity_lbl
                  text: "Vanity"
                  align: CENTER
        - button:
            id: light_bedroom_btn
            x: 12
            y: 86
            width: 86
            height: 40
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute:
                  id: select_light
                  idx: 2
            widgets:
              - label:
                  id: light_bedroom_lbl
                  text: "Bedroom"
                  align: CENTER
        - button:
            id: light_hall_btn
            x: 104
            y: 86
            width: 86
            height: 40
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute:
                  id: select_light
                  idx: 3
            widgets:
              - label:
                  id: light_hall_lbl
                  text: "Hall"
                  align: CENTER
        - button:
            id: light_office_btn
            x: 12
            y: 132
            width: 86
            height: 40
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute:
                  id: select_light
                  idx: 4
            widgets:
              - label:
                  id: light_office_lbl
                  text: "Office"
                  align: CENTER
        - button:
            id: light_upstairs_btn
            x: 104
            y: 132
            width: 86
            height: 40
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute:
                  id: select_light
                  idx: 5
            widgets:
              - label:
                  id: light_upstairs_lbl
                  text: "Upstairs"
                  align: CENTER
        - button:
            x: 196
            y: 50
            width: 116
            height: 32
            styles: [lv_style_btn_ok]
            group: nav_group
            on_click:
              - script.execute: selected_light_toggle
            widgets:
              - label:
                  text: "Toggle"
                  align: CENTER
        - button:
            x: 196
            y: 88
            width: 56
            height: 32
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute: selected_light_dimmer
            widgets:
              - label:
                  text: "Dim"
                  align: CENTER
        - button:
            x: 256
            y: 88
            width: 56
            height: 32
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: selected_light_brighter
            widgets:
              - label:
                  text: "Bright"
                  align: CENTER
        - button:
            x: 196
            y: 126
            width: 56
            height: 32
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - script.execute: selected_light_warm
            widgets:
              - label:
                  text: "Warm"
                  align: CENTER
        - button:
            x: 256
            y: 126
            width: 56
            height: 32
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: selected_light_cool
            widgets:
              - label:
                  text: "Cool"
                  align: CENTER
        - button:
            x: 196
            y: 164
            width: 116
            height: 32
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: selected_light_preset_cycle
            widgets:
              - label:
                  text: "Preset Cycle"
                  align: CENTER
        - label:
            id: lights_preset_lbl
            x: 8
            y: 204
            width: 304
            text: "Preset"

    - id: weather_page
      styles: [lv_style_screen]
      widgets:
        - button:
            x: 8
            y: 6
            width: 60
            height: 30
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lvgl.page.show: home_page
            widgets:
              - label:
                  text: "Home"
                  align: CENTER
        - label:
            x: 124
            y: 10
            text: "Weather"
        - label:
            id: weather_temp_lbl
            x: 16
            y: 44
            text: "--"
        - label:
            id: weather_cond_lbl
            x: 16
            y: 78
            width: 288
            text: "-"
        - label:
            id: weather_feels_lbl
            x: 16
            y: 100
            width: 288
            text: "Feels --"
        - label:
            id: weather_metrics_lbl
            x: 16
            y: 126
            width: 288
            text: "metrics"

    - id: reader_page
      styles: [lv_style_screen]
      widgets:
        - button:
            x: 8
            y: 6
            width: 60
            height: 30
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lvgl.page.show: home_page
            widgets:
              - label:
                  text: "Home"
                  align: CENTER
        - label:
            x: 132
            y: 10
            text: "Reader"
        - button:
            x: 12
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: open_detail_bbc
            widgets:
              - label:
                  text: "BBC"
                  align: CENTER
        - button:
            x: 113
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: open_detail_dc
            widgets:
              - label:
                  text: "DC"
                  align: CENTER
        - button:
            x: 214
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: open_detail_loudoun
            widgets:
              - label:
                  text: "Loudoun"
                  align: CENTER
        - button:
            x: 12
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: open_detail_word
            widgets:
              - label:
                  text: "Word"
                  align: CENTER
        - button:
            x: 113
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: open_detail_quote
            widgets:
              - label:
                  text: "Quote"
                  align: CENTER

    - id: settings_page
      styles: [lv_style_screen]
      widgets:
        - button:
            x: 8
            y: 6
            width: 60
            height: 30
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lvgl.page.show: home_page
            widgets:
              - label:
                  text: "Home"
                  align: CENTER
        - label:
            x: 124
            y: 10
            text: "Settings"
        - button:
            x: 12
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: saver_timeout_down
            widgets:
              - label:
                  text: "Saver-"
                  align: CENTER
        - button:
            x: 113
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: saver_timeout_up
            widgets:
              - label:
                  text: "Saver+"
                  align: CENTER
        - button:
            x: 214
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: toggle_wake_touch
            widgets:
              - label:
                  text: "WakeTouch"
                  align: CENTER
        - button:
            x: 12
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: toggle_wake_keyboard
            widgets:
              - label:
                  text: "WakeKeys"
                  align: CENTER
        - button:
            x: 113
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: toggle_wake_trackball
            widgets:
              - label:
                  text: "WakeBall"
                  align: CENTER
        - button:
            x: 214
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: kb_backlight_toggle
            widgets:
              - label:
                  text: "KB Light"
                  align: CENTER
        - label:
            id: settings_status_lbl
            x: 12
            y: 206
            width: 296
            text: "settings"

    - id: theme_page
      styles: [lv_style_screen]
      widgets:
        - button:
            x: 8
            y: 6
            width: 60
            height: 30
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lvgl.page.show: home_page
            widgets:
              - label:
                  text: "Home"
                  align: CENTER
        - label:
            x: 134
            y: 10
            text: "Theme"
        - button:
            x: 12
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: theme_prev
            widgets:
              - label:
                  text: "Theme-"
                  align: CENTER
        - button:
            x: 113
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: theme_next
            widgets:
              - label:
                  text: "Theme+"
                  align: CENTER
        - button:
            x: 214
            y: 42
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: display_backlight_down
            widgets:
              - label:
                  text: "Disp-"
                  align: CENTER
        - button:
            x: 12
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: display_backlight_up
            widgets:
              - label:
                  text: "Disp+"
                  align: CENTER
        - button:
            x: 113
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: toggle_touch_debug
            widgets:
              - label:
                  text: "Debug"
                  align: CENTER
        - button:
            x: 214
            y: 126
            width: 94
            height: 70
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - script.execute: start_touch_calibration
            widgets:
              - label:
                  text: "TouchCal"
                  align: CENTER
        - label:
            id: theme_status_lbl
            x: 12
            y: 206
            width: 296
            text: "theme"

    - id: touch_cal_page
      styles: [lv_style_screen]
      widgets:
        - button:
            x: 8
            y: 6
            width: 56
            height: 24
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lambda: |-
                  id(touch_cal_mode) = false;
              - lvgl.page.show: theme_page
              - script.execute: lvgl_update_dynamic
            widgets:
              - label:
                  text: "Back"
                  align: CENTER
        - label:
            x: 78
            y: 8
            text: "Touch Calibration 9-Point"
        - label:
            id: touch_cal_p0_lbl
            x: 20
            y: 36
            text: "+"
        - label:
            id: touch_cal_p1_lbl
            x: 160
            y: 36
            text: "+"
        - label:
            id: touch_cal_p2_lbl
            x: 300
            y: 36
            text: "+"
        - label:
            id: touch_cal_p3_lbl
            x: 20
            y: 110
            text: "+"
        - label:
            id: touch_cal_p4_lbl
            x: 160
            y: 110
            text: "+"
        - label:
            id: touch_cal_p5_lbl
            x: 300
            y: 110
            text: "+"
        - label:
            id: touch_cal_p6_lbl
            x: 20
            y: 184
            text: "+"
        - label:
            id: touch_cal_p7_lbl
            x: 160
            y: 184
            text: "+"
        - label:
            id: touch_cal_p8_lbl
            x: 300
            y: 184
            text: "+"
        - label:
            id: touch_cal_step_lbl
            x: 12
            y: 206
            width: 308
            text: "1/9 TOP LEFT"
        - label:
            id: touch_cal_result_lbl
            x: 12
            y: 222
            width: 308
            text: "Result"

    - id: shortcuts_page
      styles: [lv_style_screen]
      widgets:
        - button:
            x: 8
            y: 6
            width: 60
            height: 30
            styles: [lv_style_btn_soft]
            group: nav_group
            on_click:
              - lvgl.page.show: home_page
            widgets:
              - label:
                  text: "Home"
                  align: CENTER
        - label:
            x: 80
            y: 10
            text: "Keyboard Shortcuts"
        - label:
            id: shortcuts_body_lbl
            x: 12
            y: 44
            width: 308
            text: "shortcuts"

    - id: detail_page
      styles: [lv_style_screen]
      widgets:
        - button:
            x: 8
            y: 6
            width: 60
            height: 30
            styles: [lv_style_btn]
            group: nav_group
            on_click:
              - lvgl.page.show: reader_page
            widgets:
              - label:
                  text: "Back"
                  align: CENTER
        - label:
            id: detail_title_lbl
            x: 70
            y: 10
            text: "Detail"
        - label:
            id: detail_body_lbl
            x: 12
            y: 42
            width: 296
            height: 184
            text: ""
