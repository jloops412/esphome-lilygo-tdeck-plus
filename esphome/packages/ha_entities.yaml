text_sensor:
  - platform: wifi_info
    ip_address:
      name: "${friendly_name} IP Address"

  - platform: template
    name: "${friendly_name} Last Key"
    id: kb_last_text
    icon: mdi:keyboard
    lambda: |-
      return id(kb_last_text_buf);
    update_interval: 1s

  - platform: template
    id: current_page_name
    name: "${friendly_name} Current Page"
    lambda: |-
      if (id(page_index) == 0) return {"Lights"};
      if (id(page_index) == 1) return {"LightCtl"};
      if (id(page_index) == 2) return {"Presets"};
      if (id(page_index) == 3) return {"Weather"};
      if (id(page_index) == 4) return {"Feeds"};
      return {"Settings"};
    update_interval: 1s

  - platform: homeassistant
    id: foyer_state
    entity_id: light.foyer_lights
    internal: true
  - platform: homeassistant
    id: vanity_state
    entity_id: light.main_vanity_lights
    internal: true
  - platform: homeassistant
    id: bedroom_state
    entity_id: light.bedroom_lamp
    internal: true
  - platform: homeassistant
    id: hall_state
    entity_id: light.hall_lights
    internal: true
  - platform: homeassistant
    id: office_state
    entity_id: light.office_lamps
    internal: true
  - platform: homeassistant
    id: upstairs_state
    entity_id: light.upstairs_lights
    internal: true

  - platform: homeassistant
    id: wx_condition
    entity_id: sensor.openweathermap_condition
    internal: true
  - platform: homeassistant
    id: wx_weather
    entity_id: sensor.openweathermap_weather
    internal: true

  - platform: homeassistant
    id: word_of_day
    entity_id: sensor.word_of_the_day
    internal: true
  - platform: homeassistant
    id: quote_of_hour
    entity_id: sensor.quote_of_the_hour
    internal: true

  - platform: homeassistant
    id: feed_bbc_title
    entity_id: event.bbc_news
    attribute: title
    internal: true
  - platform: homeassistant
    id: feed_bbc_message
    entity_id: event.bbc_news
    attribute: message
    internal: true
  - platform: homeassistant
    id: feed_bbc_event_type
    entity_id: event.bbc_news
    attribute: event_type
    internal: true
  - platform: homeassistant
    id: feed_bbc_state
    entity_id: event.bbc_news
    internal: true

  - platform: homeassistant
    id: feed_dc_title
    entity_id: event.dc_news_now_dc_virginia_maryland_news_weather_traffic_sports_live
    attribute: title
    internal: true
  - platform: homeassistant
    id: feed_dc_message
    entity_id: event.dc_news_now_dc_virginia_maryland_news_weather_traffic_sports_live
    attribute: message
    internal: true
  - platform: homeassistant
    id: feed_dc_event_type
    entity_id: event.dc_news_now_dc_virginia_maryland_news_weather_traffic_sports_live
    attribute: event_type
    internal: true
  - platform: homeassistant
    id: feed_dc_state
    entity_id: event.dc_news_now_dc_virginia_maryland_news_weather_traffic_sports_live
    internal: true

  - platform: homeassistant
    id: feed_loudoun_title
    entity_id: event.loudoun_county_va_news_flash
    attribute: title
    internal: true
  - platform: homeassistant
    id: feed_loudoun_message
    entity_id: event.loudoun_county_va_news_flash
    attribute: message
    internal: true
  - platform: homeassistant
    id: feed_loudoun_event_type
    entity_id: event.loudoun_county_va_news_flash
    attribute: event_type
    internal: true
  - platform: homeassistant
    id: feed_loudoun_state
    entity_id: event.loudoun_county_va_news_flash
    internal: true

sensor:
  - platform: uptime
    name: "${friendly_name} Uptime"

  - platform: wifi_signal
    id: wifi_signal_tdeck
    name: "${friendly_name} WiFi Signal"
    update_interval: 30s

  - platform: adc
    pin: 4
    id: battery_voltage_raw
    name: "${friendly_name} Battery Voltage Raw"
    attenuation: 12db
    update_interval: 30s
    filters:
      - multiply: 2.0

  - platform: template
    id: battery_percent
    name: "${friendly_name} Battery Percent"
    unit_of_measurement: "%"
    accuracy_decimals: 0
    update_interval: 30s
    lambda: |-
      float v = id(battery_voltage_raw).state;
      float pct = ((v - 3.30f) / (4.20f - 3.30f)) * 100.0f;
      if (pct < 0) pct = 0;
      if (pct > 100) pct = 100;
      return pct;

  - platform: template
    name: "${friendly_name} Last Key Code"
    id: kb_last_code
    accuracy_decimals: 0
    icon: mdi:numeric

  - platform: template
    name: "${friendly_name} Backlight Percent"
    id: backlight_percent_sensor
    unit_of_measurement: "%"
    accuracy_decimals: 0
    lambda: |-
      return id(backlight_percent);
    update_interval: 1s

  - platform: template
    name: "${friendly_name} Keyboard Backlight Percent"
    id: kb_backlight_percent_sensor
    unit_of_measurement: "%"
    accuracy_decimals: 0
    lambda: |-
      return id(kb_backlight_percent);
    update_interval: 1s

  - platform: template
    name: "${friendly_name} Screensaver Timeout"
    id: screensaver_timeout_sensor
    unit_of_measurement: "s"
    accuracy_decimals: 0
    lambda: |-
      return id(screensaver_timeout_s);
    update_interval: 1s

  - platform: homeassistant
    id: wx_temp
    entity_id: sensor.openweathermap_temperature
    internal: true
  - platform: homeassistant
    id: wx_feels
    entity_id: sensor.openweathermap_apparent_temperature
    internal: true
  - platform: homeassistant
    id: wx_humidity
    entity_id: sensor.openweathermap_humidity
    internal: true
  - platform: homeassistant
    id: wx_clouds
    entity_id: sensor.openweathermap_cloud_coverage
    internal: true
  - platform: homeassistant
    id: wx_pressure
    entity_id: sensor.openweathermap_pressure
    internal: true
  - platform: homeassistant
    id: wx_uv
    entity_id: sensor.openweathermap_uv_index
    internal: true
  - platform: homeassistant
    id: wx_visibility
    entity_id: sensor.openweathermap_visibility
    internal: true
  - platform: homeassistant
    id: wx_wind_speed
    entity_id: sensor.openweathermap_wind_speed
    internal: true
